require('lo');
/**
 * User: Vladimir Bulyga <zero@cetku.net>
 * Project: node-crawler
 * Date: 24.01.13 23:23
 */
var extend = function Extend() {
    var object = Object.create(Object.prototype, {
        extend  :   {
            writeable   :   false,
            configurable:   false,
            enumerable  :   false,
            value       :   function(o, dst) {
                dst = dst || this;
                var set = function(key, value) {
                    if (Array.isArray(object)) {
                        dst.push(value || o[key]);
                    } else {
                        if ((value||o[key]) === undefined) return;
                        dst[key] = value || o[key];
                    }
                };

                for( var k in o ) {
                    if (!o.hasOwnProperty(k)) continue;

                    var type = {
                        '[object Object]'   :   {},
                        '[object Array]'    :   []
                    }[toString.call(o[k])];
                    if (!dst[k]) set(k, type);
                    if (type) {
                        set(k, extend(dst[k], o[k]));
                    }
                }
            }
        }
    });

    Array.prototype.slice.call(arguments).forEach(function(e) {
        object.extend(e);
    });
    return object;
};

var obj = {
    some: {
        deep : {
            object: 'hello'
        }
    }
};

var z = extend(obj, {
    some: {
        deep: {
            hello: 'world'
        }
    }
});

console.inspect(z);